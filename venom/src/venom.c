#include <stdio.h>
#define SIZE 1116
unsigned char board[2809] = {20, 98, 19, 47, 34, 46, 41, 47, 41, 40, 46, 8, 43, 42, 41, 43, 43, 43, 43, 41, 42, 41, 42, 41, 27, 40, 42, 42, 46, 40, 43, 8, 41, 0, 41, 42, 41, 43, 43, 43, 46, 42, 92, 45, 42, 43, 42, 40, 42, 43, 46, 35, 43, 46, 20, 10, 10, 10, 10, 10, 10, 10, 43, 27, 41, 92, 10, 10, 10, 10, 10, 116, 24, 40, 90, 35, 10, 10, 10, 10, 10, 89, 10, 10, 46, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 41, 27, 46, 10, 10, 10, 10, 10, 10, 42, 27, 43, 43, 8, 41, 47, 41, 40, 41, 43, 41, 43, 42, 42, 43, 45, 43, 43, 42, 40, 42, 43, 46, 41, 43, 42, 125, 40, 47, 34, 8, 41, 43, 41, 8, 46, 43, 43, 46, 41, 43, 92, 43, 43, 41, 20, 41, 43, 41, 35, 40, 42, 8, 46, 43, 10, 10, 10, 10, 10, 10, 10, 92, 42, 77, 41, 24, 10, 10, 10, 10, 10, 10, 22, 34, 10, 43, 10, 10, 10, 10, 10, 10, 10, 24, 43, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 24, 42, 10, 10, 10, 10, 10, 10, 45, 7, 46, 46, 10, 43, 10, 41, 10, 41, 92, 43, 44, 42, 40, 10, 42, 10, 40, 10, 41, 26, 41, 42, 41, 43, 10, 43, 10, 41, 10, 8, 64, 46, 40, 41, 47, 10, 46, 10, 47, 10, 22, 64, 43, 35, 40, 43, 10, 40, 10, 43, 10, 43, 8, 41, 27, 10, 10, 10, 10, 10, 10, 27, 45, 10, 41, 77, 10, 10, 10, 10, 20, 10, 116, 41, 10, 40, 10, 10, 10, 10, 10, 77, 10, 27, 41, 10, 46, 10, 10, 10, 10, 10, 27, 10, 10, 46, 27, 35, 10, 10, 10, 10, 77, 7, 43, 10, 41, 27, 10, 10, 24, 92, 77, 22, 1, 43, 20, 43, 77, 10, 10, 26, 10, 27, 10, 27, 41, 24, 41, 27, 92, 10, 24, 10, 24, 10, 77, 43, 27, 43, 1, 77, 10, 89, 10, 26, 10, 22, 42, 24, 41, 89, 26, 10, 77, 26, 89, 42, 10, 41, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 41, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 43, 10, 10, 10, 10, 10, 10, 40, 10, 41, 10, 10, 10, 10, 10, 10, 10, 10, 42, 24, 43, 10, 10, 10, 10, 10, 10, 10, 77, 41, 24, 43, 10, 92, 10, 10, 10, 77, 10, 77, 43, 26, 46, 10, 10, 10, 10, 10, 10, 10, 77, 45, 10, 41, 10, 10, 10, 10, 10, 10, 42, 24, 41, 42, 40, 42, 43, 43, 45, 43, 42, 22, 43, 43, 43, 41, 40, 41, 47, 41, 46, 43, 8, 46, 8, 42, 40, 35, 41, 43, 41, 40, 41, 43, 43, 116, 43, 41, 46, 43, 43, 46, 41, 41, 43, 41, 8, 34, 47, 40, 60, 42, 43, 8, 46, 34, 10, 10, 10, 10, 10, 10, 10, 10, 42, 22, 41, 10, 10, 10, 10, 10, 10, 10, 1, 43, 10, 43, 10, 10, 10, 10, 10, 26, 10, 10, 41, 24, 41, 10, 10, 10, 10, 10, 10, 10, 24, 43, 27, 41, 10, 10, 10, 10, 10, 10, 46, 92, 20, 46, 40, 43, 42, 244, 40, 47, 34, 46, 41, 8, 41, 41, 46, 43, 43, 46, 41, 43, 8, 43, 43, 41, 40, 41, 43, 41, 35, 40, 42, 92, 46, 47, 43, 46, 41, 47, 41, 40, 41, 43, 8, 43, 41, 42, 43, 45, 43, 43, 42, 40, 42, 40, 26, 10, 10, 10, 10, 10, 10, 10, 46, 77, 43, 77, 10, 10, 10, 10, 10, 10, 27, 46, 10, 46, 10, 92, 10, 10, 10, 90, 10, 10, 41, 10, 41, 10, 10, 10, 10, 10, 10, 10, 10, 40, 7, 43, 10, 10, 10, 10, 10, 10, 43, 24, 183, 42, 92, 42, 43, 43, 45, 43, 42, 40, 43, 43, 43, 8, 40, 41, 47, 41, 46, 43, 42, 46, 43, 42, 40, 35, 41, 43, 41, 8, 41, 43, 43, 46, 43, 41, 46, 43, 43, 46, 22, 41, 42, 41, 8, 34, 47, 40, 163, 42, 43, 42, 46, 42, 10, 10, 10, 10, 10, 10, 10, 27, 43, 77, 46, 26, 10, 10, 10, 10, 10, 10, 77, 43, 10, 43, 10, 10, 10, 10, 10, 10, 10, 26, 41, 10, 34, 10, 10, 10, 10, 10, 10, 10, 10, 43, 24, 43, 10, 10, 10, 10, 10, 90, 67, 27, 43, 10, 10, 10, 10, 10, 10, 10, 10, 42, 10, 40, 10, 10, 10, 10, 10, 10, 10, 10, 45, 10, 46, 10, 10, 10, 10, 10, 10, 10, 10, 35, 10, 47, 10, 10, 10, 10, 10, 10, 10, 10, 46, 10, 41, 10, 10, 10, 10, 10, 10, 40, 10, 40, 24, 10, 27, 10, 26, 10, 10, 89, 206, 10, 41, 20, 10, 77, 10, 24, 116, 10, 7, 43, 10, 41, 24, 10, 27, 10, 27, 26, 10, 22, 40, 10, 40, 27, 10, 1, 10, 77, 24, 10, 10, 35, 24, 46, 24, 10, 89, 10, 116, 27, 47, 10, 46, 77, 10, 10, 77, 22, 26, 10, 27, 40, 92, 47, 27, 10, 10, 77, 10, 89, 10, 24, 43, 24, 41, 24, 27, 10, 77, 10, 1, 10, 22, 42, 24, 46, 26, 92, 10, 27, 10, 27, 10, 27, 43, 77, 43, 10, 89, 10, 24, 10, 77, 34, 10, 41, 10, 10, 10, 10, 10, 10, 10, 10, 47, 10, 41, 10, 116, 10, 10, 10, 10, 10, 10, 41, 10, 41, 10, 22, 10, 10, 10, 10, 116, 10, 42, 10, 42, 10, 10, 10, 10, 10, 10, 10, 10, 42, 10, 43, 10, 10, 10, 10, 10, 10, 46, 10, 42, 10, 10, 10, 10, 10, 10, 20, 10, 34, 26, 46, 10, 116, 10, 10, 10, 22, 21, 27, 40, 24, 41, 10, 21, 10, 10, 10, 89, 116, 26, 46, 24, 43, 10, 92, 10, 10, 10, 10, 10, 26, 149, 10, 46, 10, 10, 10, 10, 10, 10, 41, 24, 41, 47, 41, 46, 43, 47, 46, 214, 42, 8, 35, 8, 43, 41, 40, 41, 43, 43, 45, 43, 22, 46, 116, 43, 46, 41, 41, 41, 41, 41, 34, 8, 40, 8, 42, 43, 40, 46, 41, 42, 41, 42, 46, 43, 45, 43, 42, 41, 43, 43, 43, 46, 40, 42, 10, 10, 10, 10, 10, 10, 10, 10, 41, 20, 47, 10, 10, 10, 10, 10, 10, 10, 27, 43, 92, 34, 10, 10, 10, 10, 10, 77, 10, 10, 43, 24, 46, 10, 10, 10, 10, 10, 10, 10, 24, 47, 24, 41, 10, 10, 10, 10, 10, 10, 41, 27, 8, 43, 43, 46, 42, 43, 45, 43, 43, 8, 40, 20, 43, 46, 35, 43, 42, 6, 46, 47, 92, 46, 8, 47, 41, 40, 46, 43, 43, 43, 41, 8, 43, 43, 43, 41, 42, 41, 42, 41, 46, 40, 34, 42, 46, 40, 43, 34, 41, 41, 41, 41, 41, 43, 24, 10, 10, 10, 10, 10, 10, 10, 41, 26, 1, 27, 116, 10, 10, 10, 10, 10, 24, 35, 10, 40, 10, 21, 10, 10, 10, 22, 10, 10, 41, 10, 42, 10, 10, 10, 10, 10, 10, 10, 10, 46, 77, 41, 10, 10, 10, 10, 10, 22, 46, 26, 45, 43, 20, 42, 43, 45, 43, 43, 42, 41, 42, 42, 46, 8, 43, 42, 228, 40, 47, 34, 43, 41, 190, 41, 41, 46, 43, 43, 46, 8, 43, 47, 43, 40, 41, 40, 41, 43, 41, 35, 92, 42, 41, 46, 46, 43, 46, 41, 47, 41, 40, 43, 43, 43, 10, 10, 10, 10, 10, 10, 10, 24, 46, 26, 43, 77, 10, 10, 10, 10, 10, 10, 77, 42, 10, 42, 10, 10, 10, 10, 10, 10, 10, 24, 41, 10, 42, 10, 10, 10, 10, 10, 10, 10, 10, 47, 77, 34, 10, 10, 10, 10, 90, 89, 43, 24, 42, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 35, 10, 10, 10, 10, 10, 10, 10, 10, 132, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 40, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 41, 10, 47, 10, 10, 10, 10, 10, 10, 46, 10, 41, 20, 10, 27, 10, 7, 10, 10, 10, 43, 10, 46, 26, 10, 24, 10, 77, 10, 116, 10, 46, 10, 40, 77, 10, 26, 10, 71, 10, 10, 10, 41, 10, 43, 27, 10, 77, 10, 89, 10, 10, 10, 40, 26, 40, 7, 10, 27, 10, 90, 10, 41, 10, 43, 89, 10, 27, 26, 77, 90, 92, 24, 46, 77, 43, 27, 10, 7, 77, 77, 92, 10, 22, 47, 20, 46, 24, 1, 27, 27, 27, 92, 10, 27, 43, 27, 45, 26, 24, 24, 1, 24, 77, 10, 24, 46, 7, 144, 77, 20, 26, 89, 26, 26, 43, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 41, 10, 42, 10, 116, 10, 10, 10, 10, 10, 10, 43, 10, 41, 10, 10, 10, 10, 10, 10, 116, 10, 43, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 42, 10, 10, 10, 10, 10, 10, 43, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 24, 40, 10, 10, 10, 10, 10, 10, 116, 24, 46, 77, 42, 10, 10, 10, 10, 10, 24, 10, 24, 43, 26, 42, 10, 10, 10, 10, 10, 10, 10, 24, 43, 10, 43, 10, 10, 10, 10, 10, 10, 43, 77, 8, 46, 40, 41, 47, 41, 46, 34, 47, 40, 111, 116, 43, 35, 46, 43, 42, 40, 42, 43, 8, 45, 8, 42, 46, 43, 43, 43, 41, 40, 41, 22, 41, 34, 43, 40, 46, 42, 42, 40, 35, 41, 8, 41, 42, 41, 43, 43, 43, 43, 41, 46, 43, 40, 10, 10, 10, 10, 10, 10, 10, 10, 43, 77, 43, 10, 10, 10, 10, 10, 10, 10, 77, 47, 1, 42, 10, 10, 10, 10, 10, 27, 10, 10, 42, 77, 43, 10, 10, 10, 10, 10, 10, 10, 77, 41, 26, 46, 10, 10, 10, 10, 10, 10, 41, 7, 41, 43, 43, 41, 40, 41, 43, 41, 35, 92, 42, 8, 46, 47, 43, 46, 41, 47, 41, 40, 8, 43, 20, 43, 41, 42, 43, 45, 43, 43, 42, 43, 42, 8, 46, 40, 43, 42, 44, 40, 47, 34, 43, 41, 41, 41, 41, 46, 43, 43, 46, 8, 43, 47, 27, 10, 10, 10, 10, 10, 10, 10, 41, 24, 45, 7, 10, 10, 10, 10, 10, 10, 27, 40, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 45, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 88, 42, 10, 10, 10, 10, 10, 10, 41, 77, 41, 34, 92, 40, 28, 42, 43, 40, 46, 40, 42, 43, 42, 8, 43, 45, 43, 42, 41, 43, 46, 43, 45, 40, 41, 47, 41, 46, 43, 8, 46, 43, 42, 41, 35, 41, 43, 41, 40, 41, 22, 43, 43, 43, 40, 46, 43, 43, 46, 41, 41, 43, 41, 46, 10, 10, 10, 10, 10, 10, 10, 26, 41, 116, 42, 27, 10, 10, 10, 10, 20, 10, 26, 43, 10, 43, 10, 10, 10, 10, 10, 77, 10, 26, 43, 10, 40, 10, 10, 10, 10, 10, 68, 10, 10, 43, 18, 42, 10, 10, 10, 10, 89, 116, 41, 20, 43, 10, 10, 10, 10, 10, 10, 92, 20, 43, 10, 46, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 42, 10, 10, 10, 10, 10, 10, 10, 10, 42, 10, 41, 10, 10, 10, 10, 10, 10, 10, 10, 41, 10, 43, 10, 10, 10, 10, 10, 10, 35, 10, 47, 77, 10, 24, 10, 89, 10, 10, 10, 41, 10, 43, 67, 10, 26, 10, 90, 10, 116, 10, 43, 10, 41, 89, 10, 77, 10, 10, 10, 10, 10, 40, 10, 47, 24, 10, 27, 10, 10, 10, 10, 10, 42, 20, 43, 26, 10, 1, 10, 10, 10, 40, 10, 46, 10, 10, 10, 10, 0, 10, 22, 10, 35, 30, 43, 10, 10, 10, 10, 77, 10, 10, 27, 41, 116, 43, 10, 89, 92, 10, 7, 27, 10, 24, 42, 22, 41, 10, 26, 90, 10, 27, 10, 10, 27, 41, 10, 45, 10, 24, 89, 10, 77, 10, 42, 10, 46, 10, 10, 10, 10, 10, 10, 10, 10, 40, 10, 43, 10, 116, 10, 10, 10, 10, 10, 10, 42, 22, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 46, 10, 22, 10, 10, 10, 10, 10, 10, 42, 22, 8, 10, 10, 10, 10, 10, 10, 8, 10, 42, 10, 10, 10, 10, 10, 10, 10, 10, 42, 26, 41, 10, 10, 10, 10, 10, 10, 10, 26, 43, 28, 43, 10, 10, 10, 10, 10, 26, 10, 27, 46, 24, 43, 10, 10, 10, 10, 10, 10, 10, 27, 41, 10, 42, 10, 10, 10, 10, 10, 10, 46, 27, 116, 46, 43, 47, 46, 125, 42, 43, 35, 46, 43, 8, 40, 41, 43, 43, 45, 43, 42, 46, 43, 43, 46, 41, 41, 41, 41, 41, 34, 43, 40, 8, 42, 43, 40, 46, 41, 42, 41, 42, 41, 43, 22, 43, 42, 41, 43, 43, 43, 46, 40, 41, 47, 35, 10, 10, 10, 10, 10, 10, 10, 10, 46, 7, 41, 10, 10, 10, 10, 10, 10, 21, 27, 43, 89, 40, 10, 10, 20, 10, 10, 7, 116, 10, 43, 29, 46, 10, 10, 10, 10, 10, 10, 10, 24, 40, 77, 43, 10, 10, 10, 10, 20, 10, 43, 89, 41, 42, 43, 45, 43, 43, 42, 40, 42, 8, 46, 41, 43, 42, 46, 40, 47, 34, 46, 41, 41, 41, 8, 46, 43, 43, 46, 41, 43, 43, 43, 42, 41, 20, 41, 43, 41, 35, 40, 42, 8, 46, 42, 43, 8, 41, 47, 41, 40, 41, 43, 92, 43, 43, 116, 10, 10, 10, 10, 10, 10, 10, 43, 27, 41, 27, 10, 10, 10, 10, 10, 10, 116, 42, 10, 47, 10, 10, 10, 10, 10, 10, 10, 86, 254, 20, 42, 10, 10, 10, 10, 10, 10, 10, 22, 42, 86, 43, 10, 10, 10, 10, 10, 10, 41, 27, 41, 42, 20, 46, 40, 43, 42, 3, 40, 46, 34, 34, 41, 8, 41, 41, 46, 43, 43, 46, 41, 43, 41, 43, 43, 41, 40, 41, 43, 8, 35, 40, 42, 40, 46, 47, 43, 46, 41, 47, 92, 40, 46, 43, 41, 43, 41, 42, 43, 45, 43, 47, 42, 40, 92, 10, 10, 10, 10, 10, 10, 22, 41, 10, 43, 7, 10, 10, 10, 10, 116, 10, 24, 42, 10, 46, 10, 10, 10, 10, 10, 7, 10, 77, 47, 10, 35, 10, 10, 10, 10, 10, 27, 10, 10, 40, 117, 40, 10, 10, 10, 10, 73, 77, 41, 10, 41, 10, 10, 10, 10, 10, 10, 10, 10, 47, 92, 40, 10, 20, 10, 10, 10, 10, 22, 10, 41, 10, 43, 10, 10, 10, 10, 10, 10, 22, 10, 34, 10, 41, 10, 10, 10, 10, 10, 10, 10, 10, 43, 10, 41, 10, 10, 10, 10, 10, 10, 40, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 41, 10, 46, 10, 10, 10, 10, 10, 10, 10, 10, 46, 10, 47, 10, 10, 10, 10, 10, 10, 10, 10, 46, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 34, 10, 47, 10, 10, 10, 10, 10, 10, 41, 10, 43, 10, 10, 10, 10, 10, 10, 10, 10, 40, 117, 42, 10, 10, 10, 10, 10, 10, 10, 77, 40, 92, 46, 10, 90, 10, 10, 10, 7, 10, 27, 41, 77, 41, 10, 20, 10, 10, 10, 10, 10, 24, 41, 10, 41, 10, 116, 10, 10, 10, 10, 43, 92, 45, 46, 8, 42, 40, 35, 41, 43, 41, 8, 41, 42, 43, 43, 43, 41, 46, 43, 43, 46, 43, 41, 96, 41, 46, 34, 47, 40, 17, 42, 43, 47, 46, 8, 42, 40, 42, 43, 43, 45, 8, 42, 41, 43, 116, 43, 41, 40, 41, 47, 41, 22, 43, 43, 10, 10, 10, 10, 10, 10, 10, 10, 43, 77, 40, 10, 10, 10, 10, 10, 10, 10, 89, 42, 20, 42, 10, 10, 10, 10, 10, 24, 10, 116, 41, 86, 41, 10, 10, 10, 10, 10, 10, 10, 86, 41, 92, 43, 10, 10, 10, 10, 10, 10, 43, 22};

unsigned short st[SIZE*3] = {0};

int main() {
    memfrob(board, 2809);
    char password[30] = {0};
    printf("Password: ");
    fgets(password, 30, stdin);
    strtok(password, "\n");
    password[27] = 0;
    int x = 0;
    int y = 0;
    int d = 0;
    int dx[4] = {11,-11,0,0};
    int dy[4] = {0,0,11,-11};
    int quote = 0;
    int esp = 0;
    int espi = 0;
    int ip = 0;

    int ret = 0;
    srand(time(NULL));

    while (1) {
        unsigned char c = board[y*53 + x];
        if (c == '"') {
            quote = 1 - quote;
        } else if (quote) {
            //printf("%d\n",c);
            st[esp] = c;
            esp++;
        } else if (c == '>') {
            d = 0;
        } else if (c == '<') {
            d = 1;
        } else if (c == 'v') {
            d = 2;
        } else if (c == '^') {
            d = 3;
        } else if (c == 'j') {
            espi++;
            esp = espi*SIZE;
        } else if ('0' <= c && c <= '9') {
            st[esp] = c - '0';
            esp++;
        } else if (c == 'g') {
            esp--;
            int pos = st[esp];
            esp--;
            int num = st[esp];
            st[esp] = st[SIZE*num+pos];
            esp++;
            //printf("got %d at stack %d, pos %d\n",st[esp-1],num,pos);
        } else if (c == 's') {
            esp--;
            int val = st[esp];
            esp--;
            int pos = st[esp];
            esp--;
            int num = st[esp];
            st[SIZE*num+pos] = val;
            //printf("stored %d at stack %d, pos %d\n",val,num,pos);
        } else if (c == 'p') {
            esp--;
        } else if (c == 'm') {
            st[esp-1] = ((st[esp-1] % 256) + 256) % 256;
        } else if (c == 'n') {
            esp--;
            int a = st[esp];
            esp--;
            int b = st[esp];
            st[esp] = (65535 - (a|b));
            esp++;
        } else if (c == '-') {
            esp--;
            int a = st[esp];
            esp--;
            int b = st[esp];
            st[esp] = b-a;
            esp++;
        } else if (c == '+') {
            esp--;
            int a = st[esp];
            esp--;
            int b = st[esp];
            st[esp] = b+a;
            esp++;
        } else if (c == '*') {
            esp--;
            int a = st[esp];
            esp--;
            int b = st[esp];
            st[esp] = b*a;
            esp++;
        } else if (c == 'c') {
            esp--;
            int a = st[esp];
            esp--;
            int b = st[esp];
            st[esp] = b^a;
            esp++;
        } else if (c == 'i') {
            st[esp] = password[ip];
            ip++;
            esp++;
        } else if (c == '|') {
            esp--;
            int b = st[esp];
            esp--;
            int a = st[esp];
            if (a>b) {
                d = 2;
            } else if (a<b) {
                d = 3;
            }
        } else if (c == '_') {
            esp--;
            int b = st[esp];
            esp--;
            int a = st[esp];
            if (a>b) {
                d = 0;
            } else if (a<b) {
                d = 1;
            }
        } else if (c == 'r') {
            esp--;
            ret = st[esp];
            break;
        } else if (c == '?') {
            d = rand()%4;
        }
        x += dx[d] + 53;
        x %= 53;
        y += dy[d] + 53;
        y %= 53;
        /*printf("%d %d %c %d",(29*x)%53,(29*y)%53,c,esp);
        int iii;
        printf("[");
        for (iii = 0; iii < st[4000]; iii++) {
            printf("%d ",st[2000+iii]);
        }
        printf("] [");
        for (iii = 0; iii < esp-4000; iii++) {
            printf("%d ",st[4000+iii]);
        }
        printf("]\n");*/
    }
    if (ret == 0) {
        printf("Correct!\n");
        password[27] = 0;
        printf("Flag: %s\n",password);
    } else {
        printf("Wrong.\n");
    }

    return 0;
}
